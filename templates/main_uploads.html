{% extends 'base.html' %}

{% block title %}
Личный кабинет — Мои аудио
{% endblock %}

{% block content %}
<h2 class="mb-4">Личный кабинет: мои загруженные аудио</h2>

<!-- === Форма загрузки файла === -->
<form method="post" enctype="multipart/form-data" class="mb-4 p-3 border rounded shadow-sm bg-light">
  {% csrf_token %}
  {{ form.file.label_tag }}
  {{ form.file }}
  {% if form.file.help_text %}
    <div class="form-text small text-muted">{{ form.file.help_text }}</div>
  {% endif %}
  <button class="btn btn-primary mt-2" type="submit">
    ➕ Загрузить аудио
  </button>
</form>

<style>
  .icon-transcribed {
    color: #28c76f;
    text-shadow: 0 0 4px rgba(40, 199, 111, 0.3);
  }
  .icon-disabled {
    opacity: 0.25;
    filter: grayscale(40%);
  }
  .audio-table th {
    background-color: #f8f9fa;
    font-weight: 600;
  }
  .audio-table td, .audio-table th {
    vertical-align: middle;
  }
  .audio-row:hover {
    background-color: #f8fbff;
    transition: background-color 0.2s ease;
  }
  .badge {
    font-size: 0.85rem;
  }
</style>

<!-- === Таблица загруженных аудио === -->
{% if tasks %}
  <table class="table table-hover align-middle audio-table shadow-sm rounded">
    <thead>
      <tr>
        <th style="width: 5%;">#</th>
        <th style="width: 45%;">Название</th>
        <th style="width: 20%;">Дата загрузки</th>
        <th style="width: 10%;">Расширение</th>
        <th style="width: 15%;">Статус</th>
        <th style="width: 5%; text-align:center;">Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr class="audio-row">
        <td>{{ forloop.counter }}</td>
        <td><strong>{{ task.audio_uploaded_title|default:"Без названия" }}</strong></td>
        <td>{{ task.audio_local_uploaded_at|date:"d.m.Y H:i" }}</td>
        <td>{{ task.audio_extension_uploaded|upper }}</td>
        <td>
          <span class="badge
            {% if task.status == 'loaded' %}
              bg-secondary
            {% elif task.status == 'processing' %}
              bg-warning text-dark
            {% elif task.status == 'done' %}
              bg-success
            {% elif task.status == 'error' %}
              bg-danger
            {% else %}
              bg-light text-dark
            {% endif %}
          ">
            {{ task.get_status_display|default:task.status }}
          </span>
        </td>
        <td class="text-center">
          {% if task.diarization_text %}
            <i class="bi bi-soundwave icon-transcribed" title="Транскрибировано"></i>
          {% else %}
            <i class="bi bi-soundwave icon-transcribed icon-disabled" title="Транскрибация недоступна"></i>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p class="text-muted">Вы ещё не загружали аудио.</p>
{% endif %}

{% endblock %}
